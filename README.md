# Data-Science-Nailgun

An advanced package for streamlined data science experimentation with support for multiple data configurations, hyperparameter tuning, automated model evaluation, and multi-experiment analysis.

## Features

- **Multiple Data Configurations**: Support for different feature sets and preprocessing strategies
- **Hyperparameter Tuning**: Automated GridSearchCV for optimal model parameters
- **Experiment Organization**: Timestamped experiment directories with comprehensive result storage
- **Post-Experiment Analysis**: Tools for model evaluation and prediction generation across multiple experiments
- **Multi-Experiment Comparison**: Compare and select best models across different experiment runs
- **YAML Configuration**: Human-readable configuration files for experiments
- **Command Line Tools**: Convenient scripts for experiment analysis and demonstration

## Installation

### Development Installation

```bash
# Clone the repository
git clone <repository-url>
cd data-science-nailgun

# Create virtual environment (recommended)
python -m venv .venv
source .venv/bin/activate  # On Windows: .venv\Scripts\activate

# Install in development mode
pip install -e .
```

### Pre-commit Setup (Optional)

```bash
pip install pre-commit
pre-commit install
```

## Project Structure

```
data-science-nailgun/
├── data/                    # Dataset files (separated from code)
│   └── titanic/
│       ├── train.csv
│       └── test.csv
├── ds_nailgun/              # Main package
│   ├── configs/
│   │   ├── examples/        # Example configurations
│   │   ├── model_presets/   # Pre-configured models
│   │   └── templates/       # Configuration templates
│   └── nailgun/             # Core modules
├── experiments/             # Experiment outputs (auto-generated)
├── scripts/                 # Utility scripts
│   └── post_experiment_demo.py
└── pyproject.toml           # Package configuration
```

## Quick Start with Titanic Example

### 1. Get the Titanic Dataset

The Titanic dataset is not included in the repository. You need to download it:

```bash
# Create data directory
mkdir -p data/titanic

# Download from Kaggle (requires Kaggle API key)
# Or manually download from: https://www.kaggle.com/c/titanic/data
# Place train.csv and test.csv in data/titanic/
```

The expected file structure is:
```
data/titanic/
├── train.csv
└── test.csv
```

### 2. Run the Example Experiment

The package includes a complete example experiment that trains Random Forest and XGBoost models on the Titanic dataset with different feature configurations.

```bash
# Run the example experiment
python -c "
from ds_nailgun.nailgun.controller import ExperimentController
controller = ExperimentController('ds_nailgun/configs/examples/titanic_experiment_config.yaml')
controller.run_experiment()
print(f'Experiment completed! Results saved to: {controller.output_dir}')
"
```

This will:
- Load 2 different data configurations (different feature sets)
- Train 2 model types (Random Forest + XGBoost) with hyperparameter tuning
- Create a timestamped experiment directory with all results
- Save trained models, hyperparameter results (CSV), and experiment summary

### 3. Analyze Results with Post-Experiment Tool

After running the experiment, use the `post-experiment` command or the demo script to analyze results and generate predictions:

```bash
# Analyze the latest experiment (replace with your experiment directory)
post-experiment experiments/titanic_survival_prediction_20250923_103134

# Or run with automatic 'yes' to generate predictions
echo "y" | post-experiment experiments/titanic_survival_prediction_20250923_103134

# Use the demo script for automated analysis
python scripts/post_experiment_demo.py experiments/ --force
```

The post-experiment tool will:
- Load all trained models from the experiment
- Evaluate models on validation data (if available) or use CV scores
- Display detailed information about the best performing model
- Prompt for confirmation before generating test predictions
- Create `test_predictions.csv` in the experiment directory

The demo script additionally supports analyzing multiple experiments simultaneously and selecting the best model across all experiments.

## Experiment Directory Structure

After running an experiment, you'll find a timestamped directory like:

```
experiments/titanic_survival_prediction_20250923_103134/
├── configs/                    # Original configuration files
│   ├── experiment_config.yaml
│   ├── data_config_1.yaml
│   └── random_forest_classifier_config.yaml
├── experiment_summary.yaml     # Human-readable experiment summary
├── logs/
│   └── titanic_experiment.log
├── models/                     # Trained pipeline models (.joblib)
├── results/                    # Hyperparameter tuning results (.csv)
└── test_predictions.csv        # Generated by post-experiment tool
```

## Configuration Files

### Data Configuration

Define your dataset structure and feature groups. Data files can be located anywhere - specify the full path or relative path from the project root:

```yaml
# Example: ds_nailgun/configs/examples/titanic_data_config.yaml
files:
  train_data: data/titanic/train.csv
  test_data: data/titanic/test.csv

data:
  id:
    column: "PassengerId"
  target:
    column: "Survived"
  features:
    passenger_info: ["Pclass", "SibSp", "Parch"]
    continuous_features: ["Age", "Fare"]
    categorical_features: ["Sex", "Embarked"]
```

### Experiment Configuration

Define the complete experiment setup:

```yaml
# Example: ds_nailgun/configs/examples/titanic_experiment_config.yaml
data:
  config_paths:
    - "ds_nailgun/configs/examples/titanic_data_config.yaml"

models:
  config_paths:
    - "ds_nailgun/configs/model_presets/random_forest_classifier_config.yaml"

experiment:
  name: "My Experiment"
  description: "Description of my experiment"
  random_seed: 42
```

## Command Line Tools

### Post-Experiment Analysis

```bash
# Show help
post-experiment --help

# Analyze experiment with user prompts
post-experiment /path/to/experiment/directory

# Skip confirmation prompts (for automation)
post-experiment --force /path/to/experiment/directory
```

### Post-Experiment Demo Script

A convenient demo script is provided to showcase the post-experiment analysis capabilities:

```bash
# Analyze a single experiment
python scripts/post_experiment_demo.py experiments/titanic_survival_prediction_20250923_103134 --force

# Analyze all experiments in a directory
python scripts/post_experiment_demo.py experiments/ --force
```

The demo script automatically:
- Detects single experiments or multiple experiments in a folder
- Loads and analyzes all trained models
- Selects the best performing model across experiments
- Generates test predictions
- Provides usage examples for the `PostExperimentAnalyzer` class

## Advanced Usage

### Custom Data Configurations

Create multiple data configurations to test different feature engineering approaches:

1. Copy an existing data config
2. Modify the `features` section with different feature groups
3. Add the new config path to your experiment configuration

### Custom Model Configurations

Define your own models with hyperparameter grids:

```yaml
# Custom model config
model:
  type: "RandomForestClassifier"
  parameters:
    n_estimators: 100
    max_depth: 10

hypertuning:
  - param: "n_estimators"
    values: [50, 100, 200]
  - param: "max_depth"
    values: [5, 10, 15, null]
```

## Contributing

1. Fork the repository
2. Create a feature branch
3. Make your changes
4. Run tests and pre-commit checks
5. Submit a pull request

## License

[Add your license information here]
